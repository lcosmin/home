#!/usr/bin/env zsh

#
# Settings
#
src_dir="$(dirname $0)/.."
src_dir="$(readlink -f $src_dir)"

echo "[+] source dir: $src_dir"

backup_dir="$HOME/.backup"
install_files=(".zshrc" 
               ".antigen-repo" 
               ".oh-my-zsh-plugins")


die() {
    echo "$1"
    exit 1
}

create_backup_dir() {
    [[ -d "$HOME" ]] || die "Home directory doesn't exist!"
    mkdir -p $backup_dir
}

install_component() {
    if [[ (( ! -f "$1" )) && (( ! -d "$1" )) ]] 
    then
        return
    fi
    echo "installing \"$1\"..."
    
    name=$(basename "$1")
    dest="$HOME/$name"
    
    if [[ (( -f "$dest" )) || (( -d "$dest" )) ]]
    then
        echo "backing up $dest to \"$backup_dir/$name\""
        mv -f "$dest" "$backup_dir/$name"
    fi
    
    ln -sfn "$1" "$dest"
}

create_backup_dir

for file in ${install_files[@]}
do
    install_component "$src_dir/$file"
done
